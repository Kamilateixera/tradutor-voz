<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tradutor por Voz</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
</head>
<body>
    <div class="container">
        <h1>Tradutor por Voz</h1>

        <div class="controls">
            <label for="origem">Idioma origem:</label>
            <select id="origem">
                <option value="pt-BR">PortuguÃªs (Brasil)</option>
                <option value="en-US">InglÃªs (EUA)</option>
                <option value="es-ES">Espanhol</option>
                <option value="fr-FR">FrancÃªs</option>
                <option value="de-DE">AlemÃ£o</option>
                <option value="it-IT">Italiano</option>
                <option value="ja-JP">JaponÃªs</option>
                <option value="ko-KR">Coreano</option>
                <option value="zh-CN">ChinÃªs (Simplificado)</option>
                <option value="ru-RU">Russo</option>
            </select>

            <label for="destino">Idioma destino:</label>
            <select id="destino">
                <option value="pt">PortuguÃªs</option>
                <option value="en">InglÃªs</option>
                <option value="es">Espanhol</option>
                <option value="fr">FrancÃªs</option>
                <option value="de">AlemÃ£o</option>
                <option value="it">Italiano</option>
                <option value="ja">JaponÃªs</option>
                <option value="ko">Coreano</option>
                <option value="zh-CN">ChinÃªs (Simplificado)</option>
                <option value="ru">Russo</option>
            </select>

            <button id="btnGravar">ğŸ™ï¸ Falar</button>
        </div>

        <p><strong>Texto reconhecido:</strong> <span id="textoReconhecido"></span></p>
        <p><strong>TraduÃ§Ã£o:</strong> <span id="traducao"></span></p>
    </div>

    <script>
      document.getElementById("btnGravar").addEventListener("click", () => {
        const origem = document.getElementById("origem").value;
        const destino = document.getElementById("destino").value;

        // Configura a API de reconhecimento de voz
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
          alert("Seu navegador nÃ£o suporta reconhecimento de voz.");
          return;
        }

        const recognition = new SpeechRecognition();
        recognition.lang = origem;
        recognition.interimResults = false;

        recognition.onstart = () => {
          document.getElementById("textoReconhecido").textContent = "ğŸ™ï¸ Ouvindo...";
          document.getElementById("traducao").textContent = "";
        };

        recognition.onresult = (event) => {
          const texto = event.results[0][0].transcript;
          document.getElementById("textoReconhecido").textContent = texto;

          // Enviar o texto para o backend para traduzir
          fetch("/traduzir", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ texto: texto, destino: destino })
          })
          .then(res => res.json())
          .then(data => {
            if (data.sucesso) {
              document.getElementById("traducao").textContent = data.traducao;
            } else {
              document.getElementById("traducao").textContent = "Erro: " + data.erro;
            }
          })
          .catch(err => {
            document.getElementById("traducao").textContent = "Erro na requisiÃ§Ã£o: " + err.message;
          });
        };

        recognition.onerror = (event) => {
          document.getElementById("textoReconhecido").textContent = "Erro: " + event.error;
        };

        recognition.start();
      });
    </script>
</body>
</html>
